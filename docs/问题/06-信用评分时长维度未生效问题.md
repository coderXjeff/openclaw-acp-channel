# 问题 06：信用评分中的时长维度未生效

## 1. 问题描述

信用评分公式依赖 `totalDurationMs`，但会话关闭流程并未将会话时长累加到联系人总时长，导致时长维度在长期评分中几乎不起作用。

## 2. 问题代码位置

- `src/credit.ts:22`：评分依赖 `contact.totalDurationMs`
- `src/monitor.ts:333`~`344`：会话关闭时仅调用 `recordSessionClose(...)`
- `src/contacts.ts:134`~`145`：`recordSessionClose()` 未使用 `durationMs` 更新 `totalDurationMs`
- `src/monitor.ts:528`：仅 `recordInteraction(sender)`，且不传 `durationMs`

## 3. 可能影响

- 信用分偏离设计意图，无法体现“稳定长会话”的正向价值。
- 低质量短消息与高质量长交流在时长维度上无法区分。
- 后续风控/信任策略基于该分数时，误判概率上升。

## 4. 修复方案

### 方案 A（推荐）：在会话关闭时累加时长

1. 在 `recordSessionClose()` 中增加 `c.totalDurationMs += durationMs`。
2. 同时更新 `interactionCount` 或新增 `sessionCount` 字段，明确统计语义。
3. 对历史数据做一次迁移或惰性修正（避免突变）。

### 方案 B：在每轮消息时累加

- 在 `recordInteraction(sender, deltaMs)` 中持续累积；需避免双重累加。

## 5. 验证建议

- 新增测试：关闭 60s 会话后，`totalDurationMs` 增长并影响 `creditScore`。
- 验证手动覆盖存在时不会被自动逻辑覆盖。
- 对比修复前后同一会话序列的评分曲线是否更符合预期。

